{# Create the data model for nodes #}
{# Uses infr_data_model.yml as source #}
#
# Node file generated by fabric2nodes.j2 using infr_data_model
#

ansible_device_type: {{ group_names[0] }}
hostname: {{ inventory_hostname }}
interfaces: 
  - name: loopback0
{% for node in nodes %}
{% if inventory_hostname == node.name %}
    ip_address: {{node.rid}}   
{% endif %}
{% endfor %}
    mask_length: 32
    description: loopback
{% for link in fabric %}
{% if link.leaf == inventory_hostname %}
  - name: {{link.leaf_port}}
    ip_address: {{link.subnet}}
{# Pending to be fixed with the interface IP address for the subnet #}
    mask_length: 31
    description: Link to {{link.spine}} {{link.spine_port}}
{% elif link.spine == inventory_hostname %}
  - name: {{link.spine_port}}
    ip_address: {{link.subnet}}
{# Pending to be fixed with the interface IP address for the subnet #}
    mask_length: 31
    description: Link to {{link.leaf}} {{link.leaf_port}}
{% endif %}
{% endfor %}

BGP:
{% for node in nodes %}
{% if inventory_hostname == node.name %}
  ASN: {{node.ASN}}
{% endif %}
{% endfor %}
  neighbors:
{% for link in fabric %}
{% if link.leaf == inventory_hostname %}
    - name: {{link.spine}}
      remote_IP: {{link.subnet}}
{# Pending to be fixed with the interface IP address for the subnet #}
{% for node in nodes %}
{% if node.name == link.spine %}
      remote_AS: {{node.ASN}}
{% endif %}
{% endfor %}
{% elif link.spine == inventory_hostname %}
    - name: {{link.leaf}}
      remote_IP: {{link.subnet}}
{# Pending to be fixed with the interface IP address for the subnet #}
{% for node in nodes %}
{% if node.name == link.leaf %}
      remote_AS: {{node.ASN}}
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}

  
